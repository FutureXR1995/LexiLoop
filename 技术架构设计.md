# LexiLoop æŠ€æœ¯æ¶æ„è®¾è®¡
## ç³»ç»Ÿæ¶æ„ä¸æŠ€æœ¯é€‰å‹è¯¦è§£

---

## ğŸ›ï¸ æ•´ä½“æ¶æ„å›¾

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   ç”¨æˆ·ç«¯     â”‚
                    â”‚ (Web/Mobile) â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
                    â”‚   CDN/è´Ÿè½½   â”‚
                    â”‚   å‡è¡¡å™¨     â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                 â”‚                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å‰ç«¯åº”ç”¨      â”‚ â”‚   APIç½‘å…³    â”‚ â”‚   é™æ€èµ„æº      â”‚
â”‚   (Next.js)    â”‚ â”‚   (Express)  â”‚ â”‚   (Vercel)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                 â”‚                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ä¸šåŠ¡æœåŠ¡      â”‚ â”‚   AIæœåŠ¡     â”‚ â”‚   ç¼“å­˜å±‚        â”‚
â”‚   (Node.js)    â”‚ â”‚   (Python)   â”‚ â”‚   (Redis)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚     æ•°æ®å±‚        â”‚
        â”‚  (PostgreSQL)     â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ–¥ï¸ å‰ç«¯æŠ€æœ¯æ¶æ„

### æŠ€æœ¯æ ˆé€‰æ‹©
```javascript
// package.json æ ¸å¿ƒä¾èµ–
{
  "dependencies": {
    "next": "^14.0.0",           // Reactæ¡†æ¶
    "react": "^18.0.0",
    "tailwindcss": "^3.0.0",     // CSSæ¡†æ¶
    "framer-motion": "^10.0.0",  // åŠ¨ç”»åº“
    "zustand": "^4.0.0",         // çŠ¶æ€ç®¡ç†
    "react-query": "^3.39.0",    // æ•°æ®è·å–
    "howler": "^2.2.0",          // éŸ³é¢‘æ’­æ”¾
    "lucide-react": "^0.263.0"   // å›¾æ ‡åº“
  }
}
```

### ç›®å½•ç»“æ„
```
frontend/
â”œâ”€â”€ ğŸ“ components/
â”‚   â”œâ”€â”€ ğŸ“ ui/                  # åŸºç¡€UIç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ Button.tsx
â”‚   â”‚   â”œâ”€â”€ Input.tsx
â”‚   â”‚   â””â”€â”€ Modal.tsx
â”‚   â”œâ”€â”€ ğŸ“ features/            # åŠŸèƒ½ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ ğŸ“ auth/
â”‚   â”‚   â”œâ”€â”€ ğŸ“ story/
â”‚   â”‚   â”œâ”€â”€ ğŸ“ test/
â”‚   â”‚   â””â”€â”€ ğŸ“ progress/
â”‚   â””â”€â”€ ğŸ“ layout/              # å¸ƒå±€ç»„ä»¶
â”œâ”€â”€ ğŸ“ pages/                   # Next.jsé¡µé¢
â”‚   â”œâ”€â”€ api/                    # APIè·¯ç”±
â”‚   â”œâ”€â”€ auth/                   # è®¤è¯é¡µé¢
â”‚   â”œâ”€â”€ learn/                  # å­¦ä¹ é¡µé¢
â”‚   â””â”€â”€ dashboard/              # ç”¨æˆ·é¢æ¿
â”œâ”€â”€ ğŸ“ hooks/                   # è‡ªå®šä¹‰Hooks
â”œâ”€â”€ ğŸ“ utils/                   # å·¥å…·å‡½æ•°
â”œâ”€â”€ ğŸ“ stores/                  # ZustandçŠ¶æ€ç®¡ç†
â””â”€â”€ ğŸ“ styles/                  # æ ·å¼æ–‡ä»¶
```

### æ ¸å¿ƒç»„ä»¶è®¾è®¡
```typescript
// æ•…äº‹é˜…è¯»ç»„ä»¶æ¶æ„
interface StoryReaderProps {
  story: Story;
  vocabulary: Vocabulary[];
  onWordClick: (word: string) => void;
  onComplete: () => void;
}

// æµ‹è¯•ç»„ä»¶æ¶æ„
interface TestComponentProps {
  questions: Question[];
  onAnswer: (answer: Answer) => void;
  onComplete: (results: TestResult) => void;
}
```

---

## âš™ï¸ åç«¯æŠ€æœ¯æ¶æ„

### æŠ€æœ¯æ ˆé€‰æ‹©
```javascript
// package.json æ ¸å¿ƒä¾èµ–
{
  "dependencies": {
    "express": "^4.18.0",        // Webæ¡†æ¶
    "typescript": "^5.0.0",      // ç±»å‹ç³»ç»Ÿ
    "prisma": "^5.0.0",          // ORMæ•°æ®åº“
    "jsonwebtoken": "^9.0.0",    // JWTè®¤è¯
    "bcryptjs": "^2.4.0",        // å¯†ç åŠ å¯†
    "redis": "^4.6.0",           // ç¼“å­˜
    "joi": "^17.9.0",            // æ•°æ®éªŒè¯
    "winston": "^3.10.0"         // æ—¥å¿—è®°å½•
  }
}
```

### APIè®¾è®¡è§„èŒƒ
```typescript
// RESTful API è®¾è®¡
interface APIEndpoints {
  // ç”¨æˆ·è®¤è¯
  'POST /api/auth/register': RegisterRequest;
  'POST /api/auth/login': LoginRequest;
  'POST /api/auth/refresh': RefreshTokenRequest;
  
  // è¯æ±‡ç®¡ç†
  'GET /api/vocabularies': GetVocabulariesRequest;
  'POST /api/vocabularies/select': SelectVocabulariesRequest;
  
  // æ•…äº‹ç”Ÿæˆ
  'POST /api/stories/generate': GenerateStoryRequest;
  'GET /api/stories/:id': GetStoryRequest;
  
  // å­¦ä¹ æµ‹è¯•
  'POST /api/tests/submit': SubmitTestRequest;
  'GET /api/tests/results/:id': GetTestResultsRequest;
  
  // ç”¨æˆ·è¿›åº¦
  'GET /api/progress': GetProgressRequest;
  'POST /api/progress/update': UpdateProgressRequest;
}
```

### æ•°æ®åº“è®¾è®¡
```sql
-- ç”¨æˆ·è¡¨
CREATE TABLE users (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  email VARCHAR(255) UNIQUE NOT NULL,
  password_hash VARCHAR(255) NOT NULL,
  username VARCHAR(100) NOT NULL,
  level VARCHAR(20) DEFAULT 'beginner',
  preferences JSONB DEFAULT '{}',
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);

-- è¯æ±‡è¡¨
CREATE TABLE vocabularies (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  word VARCHAR(100) NOT NULL,
  definition TEXT NOT NULL,
  pronunciation VARCHAR(200),
  difficulty_level INTEGER NOT NULL,
  category VARCHAR(50),
  frequency_rank INTEGER,
  created_at TIMESTAMP DEFAULT NOW()
);

-- æ•…äº‹è¡¨
CREATE TABLE stories (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  content TEXT NOT NULL,
  vocabulary_ids UUID[] NOT NULL,
  difficulty_level INTEGER NOT NULL,
  word_count INTEGER NOT NULL,
  audio_url VARCHAR(500),
  cache_key VARCHAR(255) UNIQUE,
  created_at TIMESTAMP DEFAULT NOW()
);

-- å­¦ä¹ è®°å½•è¡¨
CREATE TABLE learning_records (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID NOT NULL REFERENCES users(id),
  story_id UUID NOT NULL REFERENCES stories(id),
  vocabulary_ids UUID[] NOT NULL,
  test_results JSONB NOT NULL,
  completion_time INTEGER NOT NULL,
  accuracy_rate DECIMAL(3,2) NOT NULL,
  created_at TIMESTAMP DEFAULT NOW()
);

-- ç”¨æˆ·è¿›åº¦è¡¨
CREATE TABLE user_progress (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID NOT NULL REFERENCES users(id),
  vocabulary_id UUID NOT NULL REFERENCES vocabularies(id),
  mastery_level INTEGER DEFAULT 0,
  correct_count INTEGER DEFAULT 0,
  incorrect_count INTEGER DEFAULT 0,
  last_reviewed TIMESTAMP,
  next_review TIMESTAMP,
  UNIQUE(user_id, vocabulary_id)
);
```

---

## ğŸ¤– AIæœåŠ¡æ¶æ„

### AIæœåŠ¡æŠ€æœ¯æ ˆ
```python
# requirements.txt
fastapi==0.104.0          # Webæ¡†æ¶
openai==1.3.0             # OpenAI API
azure-cognitiveservices-speech==1.34.0  # Azure TTS
redis==5.0.0              # ç¼“å­˜
pydantic==2.5.0           # æ•°æ®éªŒè¯
sentence-transformers==2.2.2  # æ–‡æœ¬ç›¸ä¼¼åº¦
nltk==3.8.0               # è‡ªç„¶è¯­è¨€å¤„ç†
```

### æ•…äº‹ç”ŸæˆæœåŠ¡
```python
# story_generator.py
class StoryGenerator:
    def __init__(self):
        self.openai_client = OpenAI()
        self.cache = Redis()
        self.quality_validator = ContentValidator()
    
    async def generate_story(
        self, 
        vocabulary: List[str], 
        difficulty: int,
        story_type: str = "general"
    ) -> Story:
        # 1. æ£€æŸ¥ç¼“å­˜
        cache_key = self._generate_cache_key(vocabulary, difficulty, story_type)
        cached_story = await self.cache.get(cache_key)
        
        if cached_story:
            return Story.parse_json(cached_story)
        
        # 2. æ„å»ºprompt
        prompt = self._build_story_prompt(vocabulary, difficulty, story_type)
        
        # 3. è°ƒç”¨GPTç”Ÿæˆ
        response = await self.openai_client.chat.completions.create(
            model="gpt-4o",
            messages=[{"role": "user", "content": prompt}],
            temperature=0.7,
            max_tokens=1000
        )
        
        story_content = response.choices[0].message.content
        
        # 4. è´¨é‡éªŒè¯
        is_valid, quality_score = await self.quality_validator.validate(
            story_content, vocabulary
        )
        
        if not is_valid:
            # é‡æ–°ç”Ÿæˆæˆ–ä½¿ç”¨å¤‡é€‰æ–¹æ¡ˆ
            return await self._generate_fallback_story(vocabulary, difficulty)
        
        # 5. ç”ŸæˆéŸ³é¢‘
        audio_url = await self._generate_audio(story_content)
        
        # 6. åˆ›å»ºæ•…äº‹å¯¹è±¡
        story = Story(
            content=story_content,
            vocabulary=vocabulary,
            difficulty=difficulty,
            audio_url=audio_url,
            quality_score=quality_score
        )
        
        # 7. ç¼“å­˜ç»“æœ
        await self.cache.setex(
            cache_key, 
            timedelta(hours=24), 
            story.json()
        )
        
        return story
```

### å†…å®¹è´¨é‡éªŒè¯
```python
# content_validator.py
class ContentValidator:
    def __init__(self):
        self.sentence_transformer = SentenceTransformer('all-MiniLM-L6-v2')
        
    async def validate(self, content: str, vocabulary: List[str]) -> Tuple[bool, float]:
        # 1. è¯æ±‡è¦†ç›–ç‡æ£€æŸ¥
        vocab_coverage = self._check_vocabulary_coverage(content, vocabulary)
        
        # 2. å†…å®¹è¿è´¯æ€§æ£€æŸ¥
        coherence_score = self._check_coherence(content)
        
        # 3. å¯è¯»æ€§æ£€æŸ¥
        readability_score = self._check_readability(content)
        
        # 4. è¯­æ³•æ­£ç¡®æ€§æ£€æŸ¥
        grammar_score = self._check_grammar(content)
        
        # ç»¼åˆè¯„åˆ†
        overall_score = (
            vocab_coverage * 0.3 +
            coherence_score * 0.3 +
            readability_score * 0.2 +
            grammar_score * 0.2
        )
        
        is_valid = overall_score >= 0.7
        
        return is_valid, overall_score
```

---

## ğŸš€ éƒ¨ç½²ä¸è¿ç»´æ¶æ„

### äº‘æœåŠ¡é€‰æ‹©
```yaml
# docker-compose.yml
version: '3.8'
services:
  frontend:
    build: ./frontend
    ports:
      - "3000:3000"
    environment:
      - NEXT_PUBLIC_API_URL=${API_URL}
      
  backend:
    build: ./backend
    ports:
      - "8000:8000"
    environment:
      - DATABASE_URL=${DATABASE_URL}
      - REDIS_URL=${REDIS_URL}
      - OPENAI_API_KEY=${OPENAI_API_KEY}
      
  ai-service:
    build: ./ai-service
    ports:
      - "8001:8001"
    environment:
      - OPENAI_API_KEY=${OPENAI_API_KEY}
      - AZURE_SPEECH_KEY=${AZURE_SPEECH_KEY}
      
  redis:
    image: redis:7-alpine
    ports:
      - "6379:6379"
      
  postgres:
    image: postgres:15
    environment:
      - POSTGRES_DB=lexiloop
      - POSTGRES_USER=${DB_USER}
      - POSTGRES_PASSWORD=${DB_PASSWORD}
    volumes:
      - postgres_data:/var/lib/postgresql/data
```

### ç›‘æ§ä¸å‘Šè­¦
```typescript
// æ€§èƒ½ç›‘æ§æŒ‡æ ‡
interface PerformanceMetrics {
  // å“åº”æ—¶é—´æŒ‡æ ‡
  api_response_time: number;
  ai_generation_time: number;
  database_query_time: number;
  
  // ä¸šåŠ¡æŒ‡æ ‡
  daily_active_users: number;
  story_generation_count: number;
  test_completion_rate: number;
  
  // ç³»ç»ŸæŒ‡æ ‡
  cpu_usage: number;
  memory_usage: number;
  disk_usage: number;
  error_rate: number;
}
```

### æˆæœ¬æ§åˆ¶ç­–ç•¥
```typescript
// AIè°ƒç”¨æˆæœ¬æ§åˆ¶
class CostController {
  private readonly dailyBudget = 1000; // $1000/day
  private readonly hourlyLimit = 50;   // $50/hour
  
  async checkBudget(): Promise<boolean> {
    const todaySpend = await this.getTodaySpend();
    const hourlySpend = await this.getHourlySpend();
    
    return todaySpend < this.dailyBudget && 
           hourlySpend < this.hourlyLimit;
  }
  
  async optimizeGeneration(request: GenerationRequest): Promise<Strategy> {
    // 1. æ£€æŸ¥ç¼“å­˜å‘½ä¸­ç‡
    const cacheHitRate = await this.getCacheHitRate();
    
    // 2. æ ¹æ®ç”¨æˆ·ç­‰çº§è°ƒæ•´è´¨é‡
    const qualityLevel = this.getQualityLevel(request.userTier);
    
    // 3. æ‰¹é‡ç”Ÿæˆä¼˜åŒ–
    if (request.batchSize > 5) {
      return this.getBatchStrategy();
    }
    
    return this.getStandardStrategy();
  }
}
```

---

## ğŸ”’ å®‰å…¨æ¶æ„è®¾è®¡

### è®¤è¯ä¸æˆæƒ
```typescript
// JWTè®¤è¯ç­–ç•¥
interface AuthStrategy {
  accessToken: {
    expiry: '15m';
    payload: UserBasicInfo;
  };
  refreshToken: {
    expiry: '7d';
    storage: 'httpOnly cookie';
  };
  rateLimiting: {
    login: '5 attempts/hour';
    api: '1000 requests/hour';
    ai_generation: '100 requests/hour';
  };
}
```

### æ•°æ®å®‰å…¨
```sql
-- æ•°æ®åŠ å¯†ä¸è„±æ•
CREATE EXTENSION IF NOT EXISTS pgcrypto;

-- æ•æ„Ÿæ•°æ®åŠ å¯†å­˜å‚¨
ALTER TABLE users ADD COLUMN email_encrypted BYTEA;

-- æ•°æ®è®¿é—®æ—¥å¿—
CREATE TABLE access_logs (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID,
  action VARCHAR(100) NOT NULL,
  resource VARCHAR(200) NOT NULL,
  ip_address INET NOT NULL,
  user_agent TEXT,
  created_at TIMESTAMP DEFAULT NOW()
);
```

---

**è¿™ä¸ªæŠ€æœ¯æ¶æ„ç¡®ä¿LexiLoopèƒ½å¤Ÿç¨³å®šã€å®‰å…¨ã€é«˜æ•ˆåœ°ä¸ºç”¨æˆ·æä¾›AIé©±åŠ¨çš„è¯æ±‡å­¦ä¹ æœåŠ¡ï¼ŒåŒæ—¶å…·å¤‡è‰¯å¥½çš„å¯æ‰©å±•æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚**